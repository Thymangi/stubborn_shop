{# templates/cart/index.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}Mon panier{% endblock %}

{% block body %}
<h1 class="h4 mb-4">Mon panier</h1>

{# messages panier #}
{% for m in app.flashes('cart.success') %}
  <div class="alert alert-success">{{ m }}</div>
{% endfor %}
{% for m in app.flashes('cart.error') %}
  <div class="alert alert-danger">{{ m }}</div>
{% endfor %}
{% for m in app.flashes('cart.info') %}
  <div class="alert alert-info">{{ m }}</div>
{% endfor %}

{% if items is empty %}
  <div class="alert alert-secondary">Votre panier est vide.</div>
{% else %}

  {# === LIGNES PANIER === #}
  {% for row in items %}
    <div class="cart-card border rounded-3 p-3 mb-3">
      <div class="row g-3 align-items-center">

        {# vignette #}
        <div class="col-auto">
          <div class="cart-thumb">
            <img src="{{ asset(row.product.image ?? 'assets/img/placeholder.png') }}"
                 alt="{{ row.product.name }}">
          </div>
        </div>

        {# Nom / Prix / Taille sur une même ligne #}
        <div class="col">
          <div class="row g-4">
            <div class="col-12 col-md-4">
              <div class="cart-field">
                <span class="cart-key">Nom :</span>
                <span class="cart-val fw-semibold">{{ row.product.name }}</span>
              </div>
            </div>
            <div class="col-12 col-md-4">
              <div class="cart-field">
                <span class="cart-key">Prix :</span>
                <span class="cart-val">{{ row.product.price|number_format(2, ',', ' ') }} €</span>
              </div>
            </div>
            <div class="col-12 col-md-4">
              <div class="cart-field">
                <span class="cart-key">Taille :</span>
                <span class="cart-val">{{ row.size }}</span>
              </div>
            </div>
          </div>
        </div>

      </div>

      {# bouton retirer en bas à droite #}
      <form method="post"
            action="{{ path('cart_remove', { id: row.product.id, size: row.size }) }}"
            class="cart-remove m-0">
        <input type="hidden" name="_token"
               value="{{ csrf_token('cart_remove_' ~ row.product.id ~ '_' ~ row.size) }}">
        <button class="btn btn-outline-danger btn-sm">Retirer du panier</button>
      </form>
    </div>
  {% endfor %}

  {# === RÉCAP EN BAS : TOTAL + ACTIONS === #}
  <div class="cart-summary">
    <div class="cart-total">
      <div class="cart-total__label">TOTAL</div>
      <div class="cart-total__value">{{ total|number_format(2, ',', ' ') }} €</div>
    </div>

    <div class="cart-actions">
      <a href="{{ path('checkout_start') }}" class="btn btn-danger">
        Finaliser ma commande
      </a>
      <a href="{{ path('products_list') }}" class="btn btn-outline-success">
        Continuer mes achats
      </a>
    </div>
  </div>

{% endif %}
{% endblock %}